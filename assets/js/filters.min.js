!function(a,b){"use strict";var c=function(b){var c={categories:{},filters:{typology:"",topic:[]},texts:{countryPlaceholder:"Select countries",categoryPlaceholder:"Select a category",typologyPlaceholder:"Select a typology",topicPlaceholder:"Select topics",emptyFilters:"You must choose at least one filter.",noEventIds:"The filter Events IDs is empty.",testModalTitle:"Test Filters"},adminNotice:'<div id="message" class="{{type}} notice"><p>{{message}}</p></div>',testModalContent:"<p>No content</p>"};this.options=a.extend({},c,b),this.$form=a("form#post"),this.$metabox=a("#event-list-filters"),this.$filterBy=this.$metabox.find("input[name=event_list_filter_by]"),this.$country=this.$metabox.find("#venue_country_code"),this.$category=this.$metabox.find("#category"),this.$typology=this.$metabox.find("#typology"),this.$topic=this.$metabox.find("#topic"),this.$testButton=this.$metabox.find("#test-filters"),this.$testModal=null,this.$filters=null};c.prototype={init:function(){this._initFiltersDisplay(),this._initSelects(),this._createTestModal(),this._bindEvents()},_initFiltersDisplay:function(){var a=this.getFilterByValue();"event_id"===a?(this.$metabox.find("#event-ids-filters").show(),this.$metabox.find("#others-filters").hide()):(this.$metabox.find("#event-ids-filters").hide(),this.$metabox.find("#others-filters").show())},_initSelects:function(){this.$country.select2({placeholder:this.options.texts.countryPlaceholder,allowClear:!0}),this.$category.select2({placeholder:this.options.texts.categoryPlaceholder,allowClear:!0}),this._initTypologySelect2(this.$category.val(),this.options.filters.typology),this._initTopicSelect2(this.$category.val(),this.options.filters.topic)},_initTypologySelect2:function(a,b){var c=this.getCategoryData(a,"typologies");this.$typology.data("select2")&&this.$typology.find("option[value]").remove(),this.$typology.select2({placeholder:this.options.texts.typologyPlaceholder,allowClear:!0,data:c}),c.length?this.$typology.prop("disabled",!1):(b="",this.$typology.prop("disabled",!0)),this.$typology.val(b).trigger("change")},_initTopicSelect2:function(a,b){var c=this.getCategoryData(a,"topics");this.$topic.data("select2")&&this.$topic.find("option[value]").remove(),this.$topic.select2({placeholder:this.options.texts.topicPlaceholder,allowClear:!0,data:c}),c.length?this.$topic.prop("disabled",!1):(b=null,this.$topic.prop("disabled",!0)),this.$topic.val(b).trigger("change")},_createTestModal:function(){var b=this;this.$testModal=a(this.options.testModalContent),this.$testModal.dialog({dialogClass:"wp-dialog tkt-dialog no-close",title:this.options.texts.testModalTitle,modal:!0,autoOpen:!1,closeOnEscape:!1,minWidth:450,open:function(){b.$testModal.html(b.options.testModalContent),b.$testModal.load(ajaxurl,{action:"ticketea_test_filters",filters:b.getFiltersValues()})}})},_bindEvents:function(){var b=this;this.$filterBy.on("change",function(){b._initFiltersDisplay()}),this.$category.on("change",function(){var c=a(this).val();b._initTypologySelect2(c,""),b._initTopicSelect2(c,null)}),this.$testButton.on("click",function(a){a.preventDefault(),b.testFilters()}),this.$testModal.on("click",".close-modal",function(a){a.preventDefault(),b.$testModal.dialog("close")}),this.$form.submit(function(a){b.validateFilters()||a.preventDefault()})},validateFilters:function(){var a=this.getFiltersValues();if("event_id"!==this.getFilterByValue()){for(var b in a)if(a[b])return!0;return this.addAdminNotice("error",this.options.texts.emptyFilters),!1}return a.event_id?!0:(this.addAdminNotice("error",this.options.texts.noEventIds),!1)},testFilters:function(){this.$testModal.dialog("open")},addAdminNotice:function(b,c){var d=this.options.adminNotice.replace("{{type}}",b).replace("{{message}}",c);a("#message").remove(),this.$form.before(d)},getCategoryData:function(a,b){var c=[];return a&&this.options.categories[a]&&this.options.categories[a][b]&&(c=this.options.categories[a][b]),c},getFilterByValue:function(){return this.$filterBy.filter(":checked").val()},getFilters:function(){return this.$filters||(this.$filters=a('[name^="event_list_filters"]').not('[name*="_wpnonce"]')),this.$filters},getFiltersValues:function(){var b=this.getFilters(),c={},d={};return b.each(function(){var b=a.trim(a(this).val()),c=a(this).attr("name").replace(/event_list_filters/g,"").replace(/\[/g,"").replace(/\]/g,"");d[c]=b}),"event_id"===this.getFilterByValue()?c={event_id:d.event_id}:(c=d,delete c.event_id),c}},a(function(){new c(b).init()})}(jQuery,ticketeaFiltersL10n);